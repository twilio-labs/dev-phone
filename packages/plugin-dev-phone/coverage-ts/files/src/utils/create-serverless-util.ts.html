
  <!DOCTYPE html>
  <html>
    <head>
      <title>create-serverless-util.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/utils/create-serverless-util.ts</td><td class="">100.00%</td><td class="">80%</td><td class="">122</td><td class="">122</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import { TwilioServerlessApiClient } from &#x27;@twilio-labs/serverless-api&#x27;;
import fs from &#x27;fs&#x27;;
import path from &#x27;path&#x27;;

export const constants = {
    SYNC_CALL_HISTORY: &#x27;sync-call-history&#x27;,
    INCOMING_CALL_HANDLER: &#x27;incoming-call-handler&#x27;,
    OUTBOUND_CALL_HANDLER: &#x27;outbound-call-handler&#x27;,
    INCOMING_MESSAGE_HANDLER: &#x27;incoming-message-handler&#x27;
}

interface deployEvent {status: string, message: string}

interface devPhoneServerlessConfig {
    username: string,
    password: string,
    env: {
        SYNC_SERVICE_SID: string,
        CONVERSATION_SID: string,
        CONVERSATION_SERVICE_SID: string,
        DEV_PHONE_NAME: string,
        CALL_LOG_MAP_NAME: string,
        DEV_PHONE_VERSION: string
    },
    onUpdate?: (event: deployEvent) =&gt; void
}

export async function deployServerless(context: devPhoneServerlessConfig) {
    const config = {
        username: context.username,
        password: context.password,
        env: context.env,
        pkgJson: {
            &quot;dependencies&quot; : {
                &quot;twilio&quot;: &quot;^3.71.3&quot;
            }
        },
        serviceName: context.env.DEV_PHONE_NAME,
        overrideExistingService: true,
        functionsEnv: &#x27;&#x27;,
        functions: [
            {
                name: &#x27;Sync Call History&#x27;,
                path: `/${constants.SYNC_CALL_HISTORY}`,
                content: fs.readFileSync(path.join(__dirname, `../serverless/functions/${constants.SYNC_CALL_HISTORY}.js`)),
                access: &#x27;protected&#x27;,
            },
            {
                name: &#x27;Incoming Call Handler&#x27;,
                path: `/${constants.INCOMING_CALL_HANDLER}`,
                content: fs.readFileSync(path.join(__dirname, `../serverless/functions/${constants.INCOMING_CALL_HANDLER}.js`)),
                access: &#x27;protected&#x27;,
            },
            {
                name: &#x27;Incoming Message Handler&#x27;,
                path: `/${constants.INCOMING_MESSAGE_HANDLER}`,
                content: fs.readFileSync(path.join(__dirname,`../serverless/functions/${constants.INCOMING_MESSAGE_HANDLER}.js`)),
                access: &#x27;protected&#x27;,
            },
            {
                name: &#x27;Outbound Call Handler&#x27;,
                path: `/${constants.OUTBOUND_CALL_HANDLER}`,
                content: fs.readFileSync(path.join(__dirname,`../serverless/functions/${constants.OUTBOUND_CALL_HANDLER}.js`)),
                access: &#x27;protected&#x27;,
            },
        ],
        assets: []
    };

    try {
        const client = new TwilioServerlessApiClient(config);
        if (context.onUpdate) {
            const onUpdate = context.onUpdate
            //@ts-ignore
            client.on(&#x27;status-update&#x27;, (evt: deployEvent) =&gt; {
                onUpdate(evt);
            });
        }
        //@ts-ignore
        const result = await client.deployProject(config);
        return result;
    } catch (err) {
        console.log(err);
        throw new Error(&#x27;Issue deploying functions. Try again later&#x27;);
    }
}
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Tue, 21 May 2024 18:37:02 GMT</p>
    </body>
  </html>
  